<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cálculo de Horas com Firebase</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js"></script>
    <script>
       const firebaseConfig = {
  apiKey: "AIzaSyCEGc8GPFXWJl05nwMOhOxbjc-qqyRTmkk",
  authDomain: "calculo-de-horas-7d9d0.firebaseapp.com",
  databaseURL: "https://calculo-de-horas-7d9d0-default-rtdb.firebaseio.com",
  projectId: "calculo-de-horas-7d9d0",
  storageBucket: "calculo-de-horas-7d9d0.appspot.com",
  messagingSenderId: "449299445985",
  appId: "1:449299445985:web:515316055eb28ab15ddfa0",
  measurementId: "G-M3MLYSFLQN"
};

        // Inicializa Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let clienteEditando = null;

        // Função para calcular os valores
        function calcularAutomatico() {
            let design = parseFloat(document.getElementById("design").value) || 0;
            let desenvolvimento = parseFloat(document.getElementById("desenvolvimento").value) || 0;
            let valorPorHora = parseFloat(document.getElementById("valorHora").value) || 0;

            // Calcula QA e Gerência
            let qa = desenvolvimento * 0.15;
            document.getElementById("qa").value = qa.toFixed(2);
            let gerencia = (design + desenvolvimento + qa) * 0.10;
            document.getElementById("gerencia").value = gerencia.toFixed(2);

            // Calcula o total de horas
            let totalHoras = design + desenvolvimento + qa + gerencia;
            document.getElementById("totalHoras").value = totalHoras.toFixed(2);

            // Calcula o resultado final com base no valor inserido
            let resultadoFinal = totalHoras * valorPorHora;
            document.getElementById("resultado").value = resultadoFinal.toFixed(2);
        }

        // Função para salvar ou atualizar os dados no Firebase
        function salvarDados() {
            let nomeCliente = document.getElementById("nomeCliente").value;
            let design = parseFloat(document.getElementById("design").value) || 0;
            let desenvolvimento = parseFloat(document.getElementById("desenvolvimento").value) || 0;
            let qa = parseFloat(document.getElementById("qa").value) || 0;
            let gerencia = parseFloat(document.getElementById("gerencia").value) || 0;
            let totalHoras = parseFloat(document.getElementById("totalHoras").value) || 0;
            let valorPorHora = parseFloat(document.getElementById("valorHora").value) || 0;
            let resultado = parseFloat(document.getElementById("resultado").value) || 0;

            if (nomeCliente) {
                let dadosCliente = {
                    nome: nomeCliente,
                    design: design,
                    desenvolvimento: desenvolvimento,
                    qa: qa,
                    gerencia: gerencia,
                    totalHoras: totalHoras,
                    valorPorHora: valorPorHora,
                    resultado: resultado
                };

                if (clienteEditando !== null) {
                    // Atualiza cliente existente no Firebase
                    firebase.database().ref('clientes/' + clienteEditando).set(dadosCliente);
                } else {
                    // Cria novo cliente no Firebase
                    firebase.database().ref('clientes').push(dadosCliente);
                }

                clienteEditando = null;
                atualizarListaClientes();
                limparCampos();
            } else {
                alert("Por favor, insira o nome do cliente.");
            }
        }

        // Função para carregar a lista de clientes
        function atualizarListaClientes() {
            const clientesRef = firebase.database().ref('clientes');
            clientesRef.once('value', (snapshot) => {
                let lista = document.getElementById("listaClientes");
                lista.innerHTML = "";

                snapshot.forEach(function(childSnapshot) {
                    let cliente = childSnapshot.val();
                    let key = childSnapshot.key;

                    let item = document.createElement("li");

                    // Link para editar os dados do cliente
                    let link = document.createElement("a");
                    link.href = "#";
                    link.textContent = `${cliente.nome} - Total Horas: ${cliente.totalHoras.toFixed(2)}h - Valor/Hora: R$ ${cliente.valorPorHora.toFixed(2)} - Resultado: R$ ${cliente.resultado.toFixed(2)}`;
                    link.onclick = function() {
                        recuperarDados(key);
                    };

                    // Botão para deletar o cliente
                    let deletar = document.createElement("button");
                    deletar.textContent = "Deletar";
                    deletar.style.marginLeft = "10px";
                    deletar.onclick = function() {
                        deletarCliente(key);
                    };

                    item.appendChild(link);
                    item.appendChild(deletar);
                    lista.appendChild(item);
                });
            });
        }

        // Função para recuperar os dados do cliente
        function recuperarDados(key) {
            const clienteRef = firebase.database().ref('clientes/' + key);
            clienteRef.once('value').then((snapshot) => {
                let cliente = snapshot.val();

                document.getElementById("nomeCliente").value = cliente.nome;
                document.getElementById("design").value = cliente.design;
                document.getElementById("desenvolvimento").value = cliente.desenvolvimento;
                document.getElementById("qa").value = cliente.qa;
                document.getElementById("gerencia").value = cliente.gerencia;
                document.getElementById("totalHoras").value = cliente.totalHoras;
                document.getElementById("valorHora").value = cliente.valorPorHora;
                document.getElementById("resultado").value = cliente.resultado;

                clienteEditando = key;
            });
        }

        // Função para deletar um cliente
        function deletarCliente(key) {
            firebase.database().ref('clientes/' + key).remove();
            atualizarListaClientes();
        }

        // Função para limpar os campos do formulário
        function limparCampos() {
            document.getElementById("nomeCliente").value = '';
            document.getElementById("design").value = '';
            document.getElementById("desenvolvimento").value = '';
            document.getElementById("qa").value = '';
            document.getElementById("gerencia").value = '';
            document.getElementById("totalHoras").value = '';
            document.getElementById("valorHora").value = '';
            document.getElementById("resultado").value = '';
        }

        // Chama a função para atualizar a lista ao carregar a página
        window.onload = function() {
            atualizarListaClientes();
        }
    </script>
</head>
<body>
    <h1>Cálculo de Horas e Custos</h1>

    <label for="nomeCliente">Nome do Cliente:</label>
    <input type="text" id="nomeCliente" name="nomeCliente"><br><br>

    <label for="design">Horas de Design:</label>
    <input type="number" id="design" name="design" step="0.01" oninput="calcularAutomatico()"><br><br>

    <label for="desenvolvimento">Horas de Desenvolvimento:</label>
    <input type="number" id="desenvolvimento" name="desenvolvimento" step="0.01" oninput="calcularAutomatico()"><br><br>

    <label for="qa">Horas de QA (15% de Desenvolvimento):</label>
    <input type="number" id="qa" name="qa" readonly><br><br>

    <label for="gerencia">Horas de Gerência (10% do Total):</label>
    <input type="number" id="gerencia" name="gerencia" readonly><br><br>

    <label for="totalHoras">Total de Horas:</label>
    <input type="number" id="totalHoras" name="totalHoras" readonly><br><br>

    <label for="valorHora">Valor por Hora (R$):</label>
    <input type="number" id="valorHora" name="valorHora" step="0.01" oninput="calcularAutomatico()"><br><br>

    <label for="resultado">Resultado Final (R$):</label>
    <input type="number" id="resultado" name="resultado" readonly><br><br>

    <button onclick="salvarDados()">Salvar Dados</button>

    <h2>Lista de Clientes Salvos</h2>
    <ul id="listaClientes"></ul>
</body>
</html>
